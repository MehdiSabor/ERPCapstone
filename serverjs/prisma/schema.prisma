generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  code_clt            Int                   @id @default(autoincrement())
  nom                 String
  compte              String
  tel                 String?
  adresse             String?
  ville               String
  code_region         Int?
  note                String?
  createdAt           DateTime              @default(now())
  echeance            Int
  mode_paie           String?
  REMISE_G            Float
  bloquer             Boolean               @default(false)
  plafond             Float
  code_com            Int
  cond_paie           Int?
  mode_liv            String?
  code_cat            Int?
  SOLDE               Int
  avoirs              Avoirs[]
  bonliv              Bonliv[]
  comercial           Comercial             @relation(fields: [code_com], references: [code_com])
  devis               Devis[]
  facture             Facture[]
  reglements          Reglement[]
  UnifiedFactureAvoir UnifiedFactureAvoir[]
}

model Comercial {
  code_com Int      @id @default(autoincrement())
  nom      String
  tel      String?
  email    String?
  clients  Client[]
  Devis    Devis[]
}

model Article {
  id              Int             @id @default(autoincrement())
  code_art        String          @unique
  createdAt       DateTime        @default(now())
  updatedAt       DateTime?       @updatedAt
  nom             String
  desc            String?
  photo           String?
  UAF             Int?
  PA_HT           Float
  TVA             Float
  PA_TTC          Float
  PV_HT           Float
  PV_TTC          Float
  Code_fam        Int?
  code_sfam       Int?
  STK_MAX         Int
  STK_MIN         Int
  STK_SEC         Int?
  UVC             Int?
  REMISEMAX       Float?
  REF_OEM         String?
  VENTE_BLOQ      Boolean         @default(false)
  ACHAT_BLOQ      Boolean         @default(false)
  TRANS_BLOQ      Boolean         @default(false)
  LIQUIDER        Boolean         @default(false)
  code_frs        String
  familleCode_fam Int?
  qte_stk         Int
  fournisseur     Fournisseur     @relation(fields: [code_frs], references: [code_frs])
  famille         famille?        @relation(fields: [familleCode_fam], references: [code_fam])
  bonlivDetails   DetailBonliv[]
  factureDetails  DetailFacture[]
  avoirDetails    Detailavoirs[]
  devisDetails    DevisDetail[]
}

model famille {
  code_fam  Int        @id
  nom       String
  articles  Article[]
  sfamilles sfamille[]
}

model sfamille {
  code_sfam Int     @id
  nom       String
  code_fam  Int
  famille   famille @relation(fields: [code_fam], references: [code_fam])
}

model Fournisseur {
  code_frs  String    @id
  compte    String?
  sociale   String
  desc      String?
  pays      String?
  echeance  Boolean
  note      String?
  cond_paie Boolean
  bloquer   Boolean
  articles  Article[]
}

model Devis {
  REF_DEV      String        @unique
  id           Int           @id @default(autoincrement())
  DATEVALID    DateTime?
  DATE_DEV     DateTime      @default(now())
  COMPTE       String?
  CODE_CLT     Int
  CLIENT       String
  MNT_HT       Float         @default(0)
  MNT_TTC      Float         @default(0)
  REMISEG      Float?
  CODE_COM     Int
  VALIDER      Boolean       @default(false)
  REMARQUE     String?
  MODELIV      String
  MODE_PAIE    String
  NOTES        String?
  client       Client        @relation(fields: [CODE_CLT], references: [code_clt])
  comercial    Comercial     @relation(fields: [CODE_COM], references: [code_com])
  devisDetails DevisDetail[]  
}

model DevisDetail {
  REF_DEV  String
  CODE_ART String
  ARTICLE  String
  QTE      Float
  GRATUIT  Float?
  PA_HT    Float
  PV_HT    Float
  PV_TTC   Float
  REMISE   Float
  TVA      Int
  TotalHT  Float   @default(0)
  TotalTTC Float   @default(0)
  article  Article @relation(fields: [CODE_ART], references: [code_art])
  devis    Devis   @relation(fields: [REF_DEV], references: [REF_DEV], onDelete: Cascade)

  @@id([REF_DEV, CODE_ART])
}

model Bonliv {
  REF_BL        String        @id
  DATEVALID     DateTime?
  HEUREVALID    DateTime?
  REF_DEV       String
  DATE_BL       DateTime 
  COMPTE        String?
  CODE_CLT      Int
  CLIENT        String
  MNT_HT        Float
  MNT_TTC       Float
  MNT_HTliv        Float?
  MNT_TTCliv       Float?
  EN_FACTURE    Boolean
  VALIDER       Boolean
  MODELIV       String?
  MODE_PAIE     String?
  REMARQUE      String?
  CODE_CON      Int?
  CODE_ADR      Int?
  BASEHT        Boolean?
  IMPRIMER      Boolean?
  

  client        Client        @relation(fields: [CODE_CLT], references: [code_clt])
  detailBonlivs DetailBonliv[] 
}

model DetailBonliv {
  REF_BL   String  
  CODE_ART String
  ARTICLE  String
  qteliv   Float?
  QTE      Float
  GRATUIT  Float?
  PA_HT    Float
  PV_HT    Float
  PV_TTC   Float
  REMISE   Float
  REMISEG  Float?
  TVA      Int
  TotalHT  Float   @default(0)
  TotalTTC Float   @default(0)
  TotalHTliv  Float ?  
  TotalTTCliv Float ?  
  article  Article @relation(fields: [CODE_ART], references: [code_art])
  bonliv   Bonliv  @relation(fields: [REF_BL], references: [REF_BL], onDelete: Cascade)
@@id([REF_BL, CODE_ART])
}

model Facture {
  REF_FAC        String         @id
  DATEVALID      DateTime
  HEUREVALID     DateTime?
  REF_BL         String
  DATE_FAC       DateTime
  COMPTE         String?
  CODE_CLT       Int
  CLIENT         String
  MNT_HT         Float
  MNT_TTC        Float
  CODE_COM       Int
  MODELIV        String?
  MODE_PAIE      String?
  MNT_DEV        Float?
  REMARQUE       String?
  BASEHT         Boolean?
  VALIDER        Boolean
  IMPRIMER       Boolean?
  detailFactures DetailFacture[] 
  client         Client         @relation(fields: [CODE_CLT], references: [code_clt])
}

model DetailFacture {
  REF_FAC  String  @id
  CODE_ART String
  ARTICLE  String
  QTE      Float
  GRATUIT  Float?
  PA_HT    Float
  PV_HT    Float
  PV_TTC   Float
  PD_HT    Float?
  REMISE   Float
  REMISEG  Float?
  TVA      Int
  article  Article @relation(fields: [CODE_ART], references: [code_art])
  facture  Facture @relation(fields: [REF_FAC], references: [REF_FAC], onDelete: Cascade)
}

model Avoirs {
  REF_AVR      String        @id
  DATEVALID    DateTime
  HEUREVALID   DateTime?
  DATE_AVR     DateTime
  COMPTE       String?
  CODE_CLT     Int
  CLIENT       String
  MNT_HT       Float
  MNT_TTC      Float
  VALIDER      Boolean
  CODE_COM     Int
  REMARQUE     String?
  BASEHT       Boolean?
  code_clt     Int?
  client       Client        @relation(fields: [CODE_CLT], references: [code_clt])
  detailAvoirs Detailavoirs?
}

model Detailavoirs {
  REF_AVR  String  @id
  CODE_ART String
  ARTICLE  String
  QTE      Float
  GRATUIT  Float?
  PV_HT    Float
  PV_TTC   Float
  PA_HT    Float
  REMISE   Float
  REMISEG  Float?
  TVA      Int
  MAJ_STK  Boolean
  article  Article @relation(fields: [CODE_ART], references: [code_art])
  avoirs   Avoirs  @relation(fields: [REF_AVR], references: [REF_AVR])
}

model Reglement {
  REF_REGV         String           @id
  DATEVALID        DateTime
  HEUREVALID       DateTime?
  CODE_CLT         Int
  CLIENT           String
  DATE_REM         DateTime?
  DATE_ECH         DateTime?
  DATE_PNT         DateTime?
  MODE_REG         String
  MNT_REGLER       Float
  BANQUE           String?
  IMPAYER          Float?
  CPT_BNQ          Int?
  REMARQUE         String?
  TIRER            String?
  VILLE            String?
  DATE_REG         DateTime
  client           Client           @relation(fields: [CODE_CLT], references: [code_clt])
  reglementdetails ReglementDetail?
}

model ReglementDetail {
  REF_REGV            String              @id
  REF_AV_FAC          String
  DATE_DOC            DateTime
  MNT_ORIGINAL        Float
  MNT_REGLER          Float
  unifiedFactureAvoir UnifiedFactureAvoir @relation(fields: [REF_AV_FAC], references: [REF_AV_FAC])
  reglement           Reglement           @relation(fields: [REF_REGV], references: [REF_REGV])
}

model UnifiedFactureAvoir {
  REF_AV_FAC       String            @id
  DATE_DOC         DateTime
  MNT_TTC          Float
  MNT_REGLER       Float
  code_clt         Int
  reglementDetails ReglementDetail[]
  client           Client            @relation(fields: [code_clt], references: [code_clt])
}
